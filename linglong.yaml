version: "1"

package:
  id: io.github.spotify-qt
  name: spotify-qt
  version: 3.11.0.0
  kind: app
  description: |
    An unofficial Spotify client using Qt as a simpler, lighter alternative to the official client. 

command:
  - /opt/apps/io.github.spotify-qt/files/bin/spotify-qt

base: org.deepin.foundation/23.0.0
runtime: org.deepin.Runtime/23.0.1

sources:
  - kind: git
    url: https://github.com/kraxarn/spotify-qt.git
    version: master
    commit: d0151f168ccce1f961475d574ec6156737056e0d

  - kind: git
    url: https://github.com/linuxdeepin/dde-qt-dbus-factory.git
    version: master

build: |
  # build dde-qt-dbus-factory
  cd /project/linglong/sources/dde-qt-dbus-factory.git
  qmake -makefile \
        PREFIX=${PREFIX} \
        LIB_INSTALL_DIR=${PREFIX}/lib/${TRIPLET} \
        INSTALL_ROOT=${PREFIX}

  make
  make install

  # build calculator
  cd /project/linglong/sources/spotify-qt.git
  cmake -Bbuild \
        -DCMAKE_INSTALL_PREFIX=${PREFIX} \
        -DCMAKE_INSTALL_LIBDIR=${PREFIX}/lib/${TRIPLET}
        -DCMAKE_BUILD_TYPE=Release 

  cmake --build build
  cmake --build build --target install